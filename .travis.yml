version: ~> 1.0
language: node_js
branches:
  only:
  - master
os: linux
dist: focal
jobs:
  include:
  - stage: Test the project
    name: Test the project on Linux with NodeJS 14
    os: linux
    dist: focal
    node_js: '14'
    script: npm run test
  - stage: Test the project
    name: Test the project on Windows with NodeJS 14
    os: windows
    node_js: '14'
    script: npm run test
  - stage: Release to NPM
    name: Publish the package to the npmjs repository
    os: linux
    dist: focal
    node_js: '14'
    deploy:
      edge: true
      provider: npm
      email: npmjs@eraud.dev
      api_token:
        secure: TEbVeaZmZus6ufjK+7IPDy3bco7SX+5l4P0OW8KyKtqk2zoSiyvBTpUFyqWhggNzITAS7NACzWtpO2D6k6rydBdT2DxdgLIeApArNNGAaOPxvc4dcUEZyY2VJuHFXy3rbvOgleXCSJ3pqNWedET5ZiibfjOHM6np/bPAJjsu3rvEvSYr55poqIixtpR3gdaftxOzmd4RCI5DIqq+DNmKrqEGMC9zk241t0QRaiV/ZmSNGADaezAU2xnHotGaER+C7m6Cih0ioAm+zkn3VSLJrK8Ww40cukKnfRO0z0FcpQoAUsqVAplbjPYoNAE3TYfkZkKYatLnMJtzLbxqntcuK2KVgRq3O2jNYQcivsoYADN4jylh9qlRAXUAgj1KnKUhRysVg5/Cnbbgs4XuPJWiGSuVBwDIedth0tpz4oHX4chXIL3QxeCJ3aveATsgE0Zoi1xM11Q1A5CLQY4RWw30v8CzaySaV0YYQsIkoW4CGWUlEIEuzVx2e1EY/8TSPYZmuGmsPoUFQ3Wb8Sk8NxmeRqN/bfQoGaEEXOWa9PKxoV8NQDyNJCw/idaGYTItjFslnGgVrflF8QEMVoV3K0GrM1RnLa56nbYT8jNDCTq/EgGHqoUP3xUPeopYM+QyPyhD8erGNTfACwfm94OTHUGuJhVlxKxIOvt+hKaKyLX4piE=
      on:
        tags: true
        repo: lesjoursfr/html-to-epub
      cleanup: true
